---
title: "Google Data Analytics Capstone Project: Bellabeats"
author: "Peter Warren"
date: "2022-10-31"
output: 
  html_document: 
    toc: yes
    highlight: tango
    theme: yeti
---


## About This Case Study.

- The following analysis is the capstone to the "Google Data Analytics Certification" offered on Coursera.

- The project guideline is uploaded in the repo as "Case-Study-2-_-How-can-a-wellness-technology-company-play-it-smart.pdf" and is based on Google's 6 phases of data analytics.

- data is publicly available on
[Kaggle.](https://www.kaggle.com/datasets/arashnic/fitbit)

- At the time of beginning this project (2022-10-31), my knowledge and understanding of the R programming language is extremely rudimentary. For this reason, I will be doing this project in the R programming language for the entirety of the project even when I would otherwise use alternative tools. 

- I will being writing this document as if I were preparing it for my team for feedback as well as an account of my analysis for replication purposes.

#### The Senario.

- Urška Sršen, a co-founder and the Chief Creative Oﬃcer of Bellabeat, a high-tech manufacturer of health-focused
products for women, asked the marketing analytics team to focus on a Bellabeat product and analyze smart device usage data in order to gain insight into how people are already using their smart devices. Then, using this information, she would like high-level recommendations for how these trends can inform Bellabeat marketing strategy.

## Ask

#### The Business Task

- Analyze smart device usage data in order to gain insight into how consumers use non-Bellabeat smart devices. Then select one Bellabeat product to apply these insights to when presenting to stakeholders on a high-level marketing strategy recommendation. 

- The Bellabeat product I will focus on is the **[Leaf](https://bellabeat.com/product/leaf-urban/)**: Bellabeat’s classic wellness tracker can be worn as a bracelet, necklace, or clip. The Leaf tracker connects to the Bellabeat app to track **activity, sleep, and stress**. Knowing which metrics the Leaf tracks ahead of time should help guide my future analysis. 

#### Key Stakeholders 

- Urška Sršen: Bellabeat’s cofounder and Chief Creative Oﬃcer.

- Sando Mur: Mathematician and Bellabeat’s cofounder; key member of the Bellabeat executive team.

- Bellabeat marketing analytics team: A team of data analysts responsible for collecting, analyzing, and
reporting data that helps guide Bellabeat’s marketing strategy.

## Prepare

#### About the Data.

- I'll begin by locating the dataset that Urška Sršen pointed out: [FitBit Fitness Tracker Data](https://www.kaggle.com/datasets/arashnic/fitbit)

- **Sourse:** "https://zenodo.org/record/53894#.Y2Dhor7MJhF" describes the date as: "These datasets were generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring."

- **Licence:** The data is in the public domain and under no licence. 

- **Interpretation:** The "FitabaseDataDictionary.pdf" from [Fitabase](https://www.fitabase.com/resources/knowledge-base/exporting-data/data-dictionaries/) is the reference point for the metadata in this dataset. It describes the metrics taken, the contents of each file, and the column header information. 

- **Contents:** It consists of 18 csv files, however there are multiple variations of the same data. Specifically, much of the same data is stored in both a narrow and wide structure. For this analysis I will be using the narrow variations. An additional variation is a division of the data varied by time intervals, with many of the metrics being recorded as a daily total, an hourly total, and as minute totals. In this analysis I will use the shortest time interval available. There are many metrics included in this dataset however the ones I am interested in are those which overlap this the functionality of the Bellabeat Leaf. Those metrics being minute level activity levels categorized by intensity as measured by motion, and minute level sleep data. 

- **Selection:** The files from the dataset which contain the most granular view of sleep and activity are the "minuteIntensitiesNarrow_merged.csv" and the "minuteSleep_merged.csv"


#### Importing the Data.

- After downloading and extracting the data and storing it on my local machine, I'll import the data by reading each csv file to a descriptively named object. 

```{r}
# preparing the environment
install.packages("tidyverse")
library(tidyverse)

# importing the data
minuteIntensitiesNarrow <- read.csv("fitbit-fitness-tracker-data/minuteIntensitiesNarrow_merged.csv", header = TRUE, sep = ",")
minuteSleep <- read.csv("fitbit-fitness-tracker-data/minuteSleep_merged.csv", header = TRUE, sep = ",")
```

#### Inspecting the Data

- now that I have the data in the environment I'll confirm my understanding of the fitabase dictionary by viewing the structure of each file. This will give me the column names and data types for each file as well as a count of the rows in each file. 

```{r}
# set up environment
library(dplyr)

# inspecting the data
glimpse(minuteIntensitiesNarrow)

glimpse(minuteSleep)

```
- The above inspection of the data using the 'glimpse' function displayed number of columns and rows as well as all the column headers in the far left column followed by the data type in that column and then the first few rows of data. 

## Process

- One issue I see is that the "activityMinute" and "data" variables in both objects are saved as character values instead of date values so I should re-format them correctly. 

- Another issue is that the "Intensity" variable in "activityMinute" is an integer which represents the activity intensity at that minute: 0 being "Sedentary," 1 being "Light," 2 being "Moderate," and 3 being "Very Active," as defined in the fitabase data dictionary. This means that the data is not to be understood as an integer data but as categorical data. To make the data more clear and to aid my analysis, I'll convert the "Intensity" column from integer data to factor (categorical) data.

- the "Id" column is effectively a name and should also be treated as catagorical data for the survey participants.

-The "Value" attribute in "minuteSleep" indicates the sleep states 1 for asleep, 2 for restless, and 3 for awake.

- The "logId" column in  "minuteSleep" is The unique log id in Fitbit’s internal system for the sleep record. This I will discard. 

#### Cleaning The Data

- In cleaning the data, I'll start by making the above changes to "minuteIntensitesNarrow" 

```{r}

# preparing the environment
library(tidyverse)
library(lubridate) # needed for working with datatime data.

# prep for changing Id
tmp_Id <- as.character(minuteIntensitiesNarrow$Id) # as.character function to store Ids then store and pass to factor function.
tmp_id_factor <- factor(tmp_Id, levels = unique(tmp_Id)) # new factor object created with levels being the unique values in the tmp_Id object.

# prep for changing ActiveMinute
tmp_ActiveMinute <- mdy_hms(minuteIntensitiesNarrow$ActivityMinute, # creating new column with the output from the 'mdy_hms' function.
                            quiet = FALSE,
                            tz = "UTC",
                            locale = Sys.getlocale("LC_TIME"),
                            truncated = 0
)

# prep for changing Intensity
tmp_Intensity <- recode_factor(as.character(minuteIntensitiesNarrow$Intensity),
                               "0" = "Sedentary",
                               "1" = "Light",
                               "2" = "Moderatly",
                               "3" = "Very Active"
)
# creating new columns and adding them to the old in a new df.
minuteIntensitiesNarrow2 <- minuteIntensitiesNarrow %>% # creating new df with updated date for ActivityMinute Column.
  mutate( # create new columns without altering the old columns
    Id = tmp_id_factor, # new Id column now stored as factor data. 
    dateTime = tmp_ActiveMinute, # new date time data now stored as date time.
    Intensity_catagorized = tmp_Intensity # new intensity data recoded as 1 of 4 activity level categories.
  )

# creating a new df with just the new columns. 
minuteIntensitiesNarrow3 <- select(minuteIntensitiesNarrow2, Id, dateTime, Intensity_catagorized)
glimpse(minuteIntensitiesNarrow3)


```
- The new data frame is now comprised of 3 columns just like the before however now the variable "ActiveMinute" is now "dateTime" and is in a "POSIXct" data type(a type of datetime data type). I can also see that the number of observations has not changed either so I know I haven't lost any rows. Though I should confirm I don't have any null values in the new variable. 

```{r}
glimpse(minuteIntensitiesNarrow3[complete.cases(minuteIntensitiesNarrow3),]) # returns only rows with no NA values.
```
- The number of observations is the same as the as before after putting the df through the 'complete.case' function which means its not missing any rows. 

- This same issue exists for "minuteSleep" so I'll just run it through the same procedure.

```{r}

### prep for changing Id
tmp_Id <- as.character(minuteSleep$Id) # as.character function to store Ids then store and pass to factor function.
tmp_id_factor <- factor(tmp_Id, levels = unique(tmp_Id)) # new factor object created with levels being the unique values in the tmp_Id object.

### prep for changing date
tmp_date <- mdy_hms(minuteSleep$date, # creating new column with the output from the 'mdy_hms' function.
                    quiet = FALSE,
                    tz = "UTC",
                    locale = Sys.getlocale("LC_TIME"),
                    truncated = 0
)

### prep for changing value
tmp_value <- recode_factor(as.character(minuteSleep$value),
                           "1" = "asleep",
                           "2" = "restless",
                           "3" = "awake"
)
### creating new columns and adding them to the old in a new df.
minuteSleep2 <- minuteSleep %>% # creating new df with added columns.
  mutate( # create new columns without altering the old columns
    Id = tmp_id_factor, # new Id column now stored as factor data. 
    dateTime = tmp_date, # new date time data now stored as date time.
    Sleep_value = tmp_value
  )

### creating a new df with just the new columns. 
minuteSleep3 <- select(minuteSleep2, Id, dateTime, Sleep_value)
glimpse(minuteSleep3)
```

- Then I'll check if I introduced any NAs

```{r}
glimpse(minuteSleep3[complete.cases(minuteSleep3),]) # returns only rows with no NA values.
```
-Both of those returned the same number of rows after applying the 'complete.cases' function
so I haven't lost any data and the dates are now all in the right format.

#### Conclusion

-Now I have both new data frames each with data in the format appropriate to their contents and my analysis. 

## Analyze

- Now that I've cleaned and formatted my data, I can analyze it for specific insights. Given the nature of the data and the goal of applying that data towards the Bellabeat product the Leaf, there are a few dimensions that I would like to evaluate the data by.

- Firstly I'll evaluate activity and sleep with respect to hour of the day and day of the week. Specifically:
  - How active are were the participants on particular days of the week.
  - How active are were the participants on particular hours of the day.
  - How much of each sleep state did participants get on any particular day of the week.
  - How much of each sleep state did participants get on any particular hour of the day.

#### Adding Variables

- Now I want to create two new variables "weekDay" and "dayHour" calculated from the dateTime column.

```{r}

# extracting the day of the week and storing in "tmp_weekDay" as a factor
tmp_weekDay <- wday(
  minuteIntensitiesNarrow3$dateTime,
  label = TRUE,
  abbr = TRUE,
  week_start = getOption("lubridate.week.start", 7),
    locale = Sys.getlocale("LC_TIME")
)

# extracting hour of the day and storing in "tmp_dayHour" as int 0 to 23.
tmp_dayHour <- hour(minuteIntensitiesNarrow3$dateTime)

# adding column "dayHour" and "weekDay" to catagorized all observations.
minuteIntensitiesNarrow3 <- minuteIntensitiesNarrow3 %>%
  mutate(
    weekDay = tmp_weekDay,
    dayHour = tmp_dayHour
  )
# Inspecting the new data frame
glimpse(minuteIntensitiesNarrow3) 


```

- Now I want to do the same thing with "minuteSleep3"

```{r}

# extracting the day of the week and storing in "tmp_weekDay" as a factor
tmp_weekDay <- wday(
  minuteSleep3$dateTime,
  label = TRUE,
  abbr = TRUE,
  week_start = getOption("lubridate.week.start", 7),
    locale = Sys.getlocale("LC_TIME")
)

# extracting hour of the day and storing in "tmp_dayHour" as int 0 to 23.
tmp_dayHour <- hour(minuteSleep3$dateTime)

# adding column "dayHour" and "weekDay" to catagorized all observations.
minuteSleep3 <- minuteSleep3 %>%
  mutate(
    weekDay = tmp_weekDay,
    dayHour = tmp_dayHour
  )
# Inspecting the new data frame.
glimpse(minuteSleep3)
```

#### Activity Analyzed

- I'll start by analyzing the activity levels of the participents broken up by hour of the day and day of the week.

```{r}

# sorting the number of participants.
numbOfPart <- minuteIntensitiesNarrow3 %>%
  select(Id) %>%
  unique() %>%
  count() 

# summary of the totals for each category.
intensities_tbl <- minuteIntensitiesNarrow3 %>%
  select(Intensity_catagorized) %>%
  table()

# displaying the table
intensities_tbl 

# assigning summary results to each catagory and adveraging by the 33 participants. 
sedentary_cat <- intensities_tbl[1]/numbOfPart
light_cat <- intensities_tbl[2]/numbOfPart
moderaty_cat <- intensities_tbl[3]/numbOfPart
veryActive_cat <- intensities_tbl[4]/numbOfPart

# calculate the number of days the survey observed.
numOfDays <- max(unique(day(minuteIntensitiesNarrow3$dateTime)))


# calculating the daily averages amount of time spent in each category per participant. 
sedentary_cat/ numOfDays / 60 # divided by 60 to convert to hours.
light_cat/ numOfDays 
moderaty_cat/ numOfDays 
veryActive_cat/ numOfDays

# calculating average by hour of the day
minuteIntensitiesNarrow3 %>%
  select(dayHour, Intensity_catagorized) %>%
  table()

# calculating by particular day of the week
minuteIntensitiesNarrow3 %>%
  select(weekDay, Intensity_catagorized) %>%
  table()

```
#### Insights

- Overall the vast majority of the activity observations from each day are sedentary observations and the amount of activity recorded in general is slightly higher during the work week.


#### Sleep Analyzed

```{r}

# sorting the number of participants.
numbOfPartSleep <- minuteSleep3 %>%
  select(Id) %>%
  unique() %>%
  count() 

# summary of the totals for each category.
minuteSleep3 %>%
  summary()


# calculate the number of days the survey observed.
numOfDaysSleep <- max(unique(day(minuteSleep3$dateTime)))


# calculating by hour of the day
minuteSleep3 %>%
  select(dayHour, Sleep_value) %>%
  table()

# calculating by particular day of the week
minuteSleep3 %>%
  select(weekDay, Sleep_value) %>%
  table()

```


#### Insights
- The analysis shows that users of fitbit fitness tracker devices are not particularly active. The spent an average of 20 minutes per day in the "Very Active" intensity category.



## Share

- My first step in Sharing my findings would be to present this account of my data preparation and analysis to the members of my marketing analytics team requesting feedback.

- I would also include the following visualization as apart of my presentation to the board of executives when making my recommendations. 

```{r}
# bar chart activity by hour of the day 
minuteIntensitiesNarrow3 %>%
  select(dayHour, Intensity_catagorized) %>%
  table() %>%
  barplot(
    main = "Morning to Night Intensity by catagory",
    beside = T
  )
```

- This bar chart shows the daily distrobution of each activity catagory over the course of an adverage day. You can see that sedentary activity is highest in the morning and at night and light activity follows an inverse distribution. Moderate activity is actually less frequent than the very active catagoyy on the far right.



```{r}
# Sleep by day of the week
minuteSleep3 %>%
  select(Sleep_value, weekDay) %>%
  table()%>%
  barplot(main = "Nightly sleep by day of the week and sleep state")
```
- Here you can see that the total time spent either in bed or asleep among the participants was lowest on Monday and Friday. Possible explanations for this being staying up late on Friday night and getting up early on Monday morning. 

```{r}
# Sleep by hour in the day
minuteSleep3 %>%
  select(Sleep_value, dayHour) %>%
  table() %>%
  barplot(main = "Daily Sleep distrobution by hour of the day"
  )


```

- In this visual you can see the distribution of sleep for all from hour to hour for all the particepents. You can see that nearly no sleep started before 9 pm and the vast majority of sleep happend between midnight and 6 am. 



## Act

#### Recommendations

- My recommendation to Urška Sršen and Sando Mur would be to cater their marketing strategy of the Leaf towards health conscious women with an already sedentary life style. The leave Is as much apparel as fitness device and so does not meet the highly active woman's demands however the Leaf could potentially take advantage of the possibly under targeted audience of women who are sedentary but also health conscious.

- I would also recommend marketing to potential Leaf users during the time they are relatively inactive but not yet sleeping. This would mean focusing on marketing after 8 pm but before 11 pm. This is the time when these types of users are inactive but aware enough to make a purchase decision. 





## Session Information 